{"version":3,"file":"bundle.umd.js","sources":["../../../../eagle-sdk/xhrHook.js","../../../../eagle-sdk/index.js"],"sourcesContent":["export default {\n    init: (cb) => {\n        let xhr = window.XMLHttpRequest\n        if (xhr._eagle_monitor_flag === true) { //防止多次引用\n            return void 0\n        }\n        xhr._eagle_monitor_flag = true;\n\n        let _originOpen = xhr.prototype.open\n        xhr.prototype.open = function (method, url, async, user, password) {\n            this._eagle_xhr_info = {\n                method, url, status: null\n            }\n            return _originOpen.apply(this, arguments)\n        }\n\n        let _originSend = xhr.prototype.send\n        xhr.prototype.send = function (value) { // post的时候value才有值\n            let _self = this\n            this._eagle_start_time = Date.now()\n\n            let ajaxEnd = (eventType) => () => {\n                if (_self.response) {\n                    debugger\n                    let responseSize = null\n                    switch (_self.responseType) {\n                        case 'json':\n                            // TODO JSON的兼容性问题 && stringify报错\n                            responseSize = JSON.stringify(_self.response).length\n                            break;\n                        case 'arraybuffer':\n                            responseSize = _self.response.byteLength\n                            break;\n                        default:\n                            responseSize = _self.responseText.length\n                            break;\n                    }\n                    _self._eagle_xhr_info.event = eventType\n                    _self._eagle_xhr_info.status = _self.status\n                    _self._eagle_xhr_info.success = _self.status === 200\n                    _self._eagle_xhr_info.duration = Date.now() - _self._eagle_start_time\n                    _self._eagle_xhr_info.responseSize = responseSize\n                    // TODO value.length一定有length吗\n                    _self._eagle_xhr_info.requestSize = value ? value.length : 0\n                    _self._eagle_xhr_info.type = 'xhr'\n                    cb(_self._eagle_xhr_info)\n                }\n            }\n\n            // 这三种都代表这请求已经结束了，需要统计一些信息，并上报上去\n            if (this.addEventListener) {\n                this.addEventListener('load', ajaxEnd('load'), false);\n                this.addEventListener('error', ajaxEnd('error'), false);\n                this.addEventListener('abort', ajaxEnd('abort'), false);\n            } else {\n                let _origin_onreadystatechange = this.onreadystatechange;\n                this.onreadystatechange = function (event) {\n                    if (_origin_onreadystatechange) {\n                        _originOpen.apply(this, arguments);\n                    }\n                    if (this.readyState === 4) {\n                        ajaxEnd('end')();\n                    }\n                };\n            }\n\n            return _originSend.apply(this, arguments)\n        }\n\n        if (window.fetch) {\n            let _origin_fetch = window.fetch;\n            window.fetch = function () {\n                let startTime = Date.now();\n                let args = [].slice.call(arguments);\n\n                let fetchInput = args[0];\n                let method = 'GET';\n                let url;\n\n                if (typeof fetchInput === 'string') {\n                    url = fetchInput;\n                } else if ('Request' in window && fetchInput instanceof window.Request) {\n                    url = fetchInput.url;\n                    if (fetchInput.method) {\n                        method = fetchInput.method;\n                    }\n                } else {\n                    url = '' + fetchInput;\n                }\n\n                if (args[1] && args[1].method) {\n                    method = args[1].method;\n                }\n\n                // TODO eagle check\n                let fetchData = {\n                    method: method,\n                    url: url,\n                    status: null,\n                };\n\n                return _origin_fetch.apply(this, args).then(function (response) {\n                    fetchData.status = response.status;\n                    fetchData.type = 'fetch';\n                    fetchData.duration = Date.now() - startTime;\n                    cb(fetchData);\n                    return response;\n                });\n            }\n        }\n    }\n}","// import perf from './perf'\n// perf.init((perfData) => {\n//     console.log('perf init')\n//     console.log(perfData)\n// })\n\n// import errorCatch from './errorCatch'\n// errorCatch.init(errorInfo => {\n//     console.log('errorInfo', errorInfo)\n// })\n\nimport xhrHook from './xhrHook'\n\nxhrHook.init((xhrInfo) => {\n    console.log(xhrInfo)\n    if (/^[45]/.test(xhrInfo.status)) { //匹配4xx,5xx开头的http状态码\n        console.log('错误信息', {\n            status: xhrInfo.status\n        })\n    }\n})\n\n// throw new Error('抛出的错误')\n\n// try {\n//     console.log('try catch====')\n//     aaa = 'bbb' + 'ccc'\n// } catch (err) {\n//     // console.log(err)\n//     throw err\n// }"],"names":[],"mappings":"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"}